<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPA Inspector Offline</title>

<!-- Thư viện cần thiết -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/plist@3.0.6/dist/plist.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bplist-parser@0.3.2/dist/bplist-parser.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 600px;
  margin: 30px auto;
  padding: 10px;
}
h1 {
  text-align: center;
  color: #222;
}
#output {
  background: #f9f9f9;
  padding: 10px;
  border-radius: 5px;
  white-space: pre-wrap;
  border: 1px solid #ddd;
}
input[type=file] {
  display: block;
  margin: 15px 0;
}
</style>
</head>

<body>
<h1>IPA Inspector (Offline)</h1>
<p>Chọn file <b>.ipa</b> từ máy của bạn để xem thông tin ứng dụng:</p>

<input type="file" id="fileInput" accept=".ipa">
<pre id="output">Chưa chọn file.</pre>

<script>
const fileInput = document.getElementById('fileInput');
const output = document.getElementById('output');

fileInput.addEventListener('change', async function() {
  const file = this.files[0];
  if (!file) return;
  output.textContent = "Đang đọc file .ipa, vui lòng chờ...";

  try {
    const arrayBuffer = await file.arrayBuffer();
    const zip = await JSZip.loadAsync(arrayBuffer);

    // Tìm file Info.plist trong IPA
    let infoPlistFile = null;
    zip.forEach((relativePath) => {
      if (relativePath.match(/Payload\/[^/]+\.app\/Info\.plist$/)) {
        infoPlistFile = relativePath;
      }
    });

    if (!infoPlistFile) {
      output.textContent = "Không tìm thấy Info.plist trong file IPA.";
      return;
    }

    const plistData = await zip.file(infoPlistFile).async("arraybuffer");
    let info = null;

    try {
      info = plist.parse(new TextDecoder().decode(plistData));
    } catch (e) {
      // Nếu Info.plist là binary, dùng bplist-parser
      info = bplistParser.parseBuffer(Buffer.from(plistData))[0];
    }

    const bundleId = info["CFBundleIdentifier"] || "Không có";
    const version = info["CFBundleShortVersionString"] || "Không có";
    const minIOS = info["MinimumOSVersion"] || "Không có";

    output.textContent =
      "📦 Tên gói (Bundle ID): " + bundleId + "\n" +
      "🔢 Phiên bản: " + version + "\n" +
      "📱 iOS tối thiểu: " + minIOS + "\n\n" +
      "✅ Đọc thành công từ file: " + file.name;
  } catch (err) {
    console.error(err);
    output.textContent = "❌ Lỗi: Không thể đọc file .ipa\nChi tiết: " + err;
  }
});
</script>
</body>
</html>